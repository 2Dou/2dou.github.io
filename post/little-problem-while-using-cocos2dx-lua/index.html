<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.68.3 with theme Tranquilpeak 0.4.8-BETA">
<meta name="author" content="SelFree">
<meta name="keywords" content="Cocos2dx-Lua, 闪退, Node::onEnterTransitionDidFinish(), program develop, leetcode, Golang, leetcode解答, 程序">
<meta name="description" content="在 Cocos2dx-Lua 的 onEnterTransitionDidFinish 中闪退">


<meta property="og:description" content="在 Cocos2dx-Lua 的 onEnterTransitionDidFinish 中闪退">
<meta property="og:type" content="article">
<meta property="og:title" content="记一次 Cocos2dx-Lua 闪退">
<meta name="twitter:title" content="记一次 Cocos2dx-Lua 闪退">
<meta property="og:url" content="https://www.orztu.com/post/little-problem-while-using-cocos2dx-lua/">
<meta property="twitter:url" content="https://www.orztu.com/post/little-problem-while-using-cocos2dx-lua/">
<meta property="og:site_name" content="Orz the way">
<meta property="og:description" content="在 Cocos2dx-Lua 的 onEnterTransitionDidFinish 中闪退">
<meta name="twitter:description" content="在 Cocos2dx-Lua 的 onEnterTransitionDidFinish 中闪退">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2018-12-22T09:22:48">
  
  
    <meta property="article:modified_time" content="2018-12-22T09:22:48">
  
  
  
    
      <meta property="article:section" content="coding life">
    
  
  


<meta name="twitter:card" content="summary">











  <meta property="og:image" content="https://www.gravatar.com/avatar/f47b51d6d6b82fd9048e3eaf64bf7e69?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/f47b51d6d6b82fd9048e3eaf64bf7e69?s=640">


    <title>记一次 Cocos2dx-Lua 闪退 | 
        Orz the way
      
    </title>
    <meta name="author" content="SelFree">
    <meta name="keywords" content="Cocos2dx-Lua, 闪退, Node::onEnterTransitionDidFinish(), program develop, leetcode, Golang, leetcode解答, 程序">
    

    <link rel="icon" href="https://www.orztu.com/images/favicon.ico">
    

    

    <link rel="canonical" href="https://www.orztu.com/post/little-problem-while-using-cocos2dx-lua/">

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
      integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css"
      integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css"
      integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />

    
    
    <link rel="stylesheet" href="https://www.orztu.com/css/style.min.css" />
    <link rel="stylesheet" href="https://www.orztu.com/css/syntax.min.css" />
    
    

    <script async data-cfasync="false" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-7873997855793576",
        enable_page_level_ads: true
      });
    </script>

    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131448352-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-131448352-1');
    </script>

    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.orztu.com/">Orz the way</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://www.orztu.com/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/f47b51d6d6b82fd9048e3eaf64bf7e69?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.orztu.com/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/f47b51d6d6b82fd9048e3eaf64bf7e69?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">SelFree</h4>
        
          <h5 class="sidebar-profile-bio"><strong>城市永远年轻，而我们终将老去</strong></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/leetcode/">
    
      <i class="sidebar-button-icon fa fa-lg fa-file-code-o"></i>
      
      <span class="sidebar-button-desc">LeetCode</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/books/">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">Books</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/archives/">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/about/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.orztu.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://www.5inb4d.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-link"></i>
      
      <span class="sidebar-button-desc">无名小小站</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://32.5inb4d.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-link"></i>
      
      <span class="sidebar-button-desc">32无名小小站</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      记一次 Cocos2dx-Lua 闪退
    </h1>
  
  
  <div class="postShorten-meta-bg">
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-12-22T09:22:48&#43;08:00">
        
  
  
  
  
    2018-12-22
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.orztu.com/categories/coding-life">coding life</a>
    
  

  </div>
  </div>


</div>

          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <h2 id="闪退点">闪退点</h2>
<p>Version: Cocos2dx-Lua 3.16</p>
<p>在某个页面修改后，出现闪退。查看修改记录没有特别的地方，均为修改图片或者条件判断。</p>
<p>启动 XCode 发现闪退位置出现在<code>void Node::onEnterTransitionDidFinish()</code>中，
在其调用子节点的<code>child-&gt;onEnterTransitionDidFinish()</code>时，<code>child</code>指针无效。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1352
</span><span class="lnt">1353
</span><span class="lnt">1354
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="p">...</span>
<span class="k">for</span><span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">child</span><span class="p">:</span> <span class="err">\</span><span class="n">_children</span><span class="p">)</span>
<span class="n">child</span><span class="o">-&gt;</span><span class="n">onEnterTransitionDidFinish</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div>
<p>此时的调用栈：</p>
<pre><code>0: void Node::onEnterTransitionDidFinish() -&gt; child-&gt;onEnterTransitionDidFinish();
1: void Director::setNextScene() -&gt; _runningScene-&gt;onEnterTransitionDidFinish();
2: void Director::drawScene() -&gt; setNextScene();
...
</code></pre><p>对应 Lua 代码流程：</p>
<pre><code>display.runScene(HomeScene)
HomeScene:ctor() {
    self:addChild(HomeLayer)
}
</code></pre><h2 id="怀疑">怀疑</h2>
<p>因为是在调用<code>Scene::onEnterTransitionDidFinish()</code>时指针无效，所以猜测是遍历过程中字节点被删除。</p>
<p>查看相关代码：</p>
<pre><code>HomeScene: 没有 onEnterTransitionDidFinish()
HomeLayer: 有 onEnterTransitionDidFinish()，
           但在 onEnterTransitionDidFinish 中没有删除 HomeScene 上的结点。
           而是往 Scene 上新增结点 addChild(GuideLayer)
</code></pre><p>因为游戏逻辑是只创建一个<code>GuideLayer</code>，重复创建时会删除上次创建的页面。又怀疑是否创建了两次<code>GuideLayer</code>。
通过屏蔽代码发现不添加<code>GuideLayer</code>就不会闪退，但是<code>GuideLayer</code>的确只创建了一次，不存在删除问题。</p>
<h2 id="真相">真相</h2>
<p>再次分析流程</p>
<pre><code>HomeScene:onEnterTransitionDidFinish():
    HomeLayer:onEnterTransitionDidFinish(
        addChild(GuideLayer)  // 添加到HomeScene上
    )

HomeScene:onEnterTransitionDidFinish() 闪退
</code></pre><p>总归问题是出现在<code>HomeScene</code>的<code>_children</code>容器上，那么既然不是删除，增加结点会导致容器出问题吗？</p>
<p>查找代码得到<code>_children</code>类型为<code>CCVector</code>，而<code>CCVector</code>通过<code>std::vector</code>实现。</p>
<p>所以出现了常见的**_问题：在容器迭代过程中删除或插入_**。</p>
<p>在新增结点往<code>std::vector</code>插入的时候，恰好超过容量大小，导致扩容。而<code>std::vector</code>是分配的连续内存，
所以扩容时候会重新分配内存，导致遍历的时候出现<code>child</code>指针无效。</p>
<pre><code>scene::onEnterTransitionDidFinish() {
    for (child: scene-&gt;children) {       
        // onEnterTransitionDidFinish里面往scene中addChild
        // 导致children容器扩容，for循环的child指针失效
        // 然后下一轮循环再到这里，child(无效指针)-&gt;onEnterTransitionDidFinish()就会闪退
        child-&gt;onEnterTransitionDidFinish();  
    }  
}
</code></pre><h2 id="else">else</h2>
<p>那么是不是就不能在<code>onEnterTransitionDidFinish</code>中添加结点呢？</p>
<p>在这个项目，许多页面都在<code>onEnterTransitionDidFinish</code>往<code>HomeScene</code>添加<code>GuideLayer</code>；或者在当前页面添加结点，为啥运行了这么久都没发现问题？</p>
<p>查看代码可以得到，<code>C++</code> 中<code>onEnterTransitionDidFinish</code>是在遍历完子节点后，
再发送消息调用<code>Lua</code>中的<code>onEnterTransitionDidFinish</code>的：</p>
<pre><code>for( const auto &amp;child: _children)
    child-&gt;onEnterTransitionDidFinish();
...
// 调用当前结点 Lua 的 onEnterTransitionDidFinish
ScriptEngineManager::sendNodeEventToLua(this, kNodeOnEnterTransitionDidFinish);
</code></pre><p>而项目中的页面管理是这样做的：进入游戏创建<code>HomeScene</code>，之后其他页面跳转均在<code>HomeScene</code>上删除和添加，几乎不会创建新 Scene 。</p>
<p>所以后面不会再遇到<code>HomeScene::onEnterTransitionDidFinish</code>遍历时添加子结点的情况；而直接往当前页面添加结点，也是在当前页面的<code>_children</code>遍历完后再添加的(Lua 中添加)。</p>
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
              
                
              
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://www.orztu.com/post/ffmpeg-commands/" data-tooltip="ffmpeg 命令行">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
              
                
              
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://www.orztu.com/post/golang-trace/" data-tooltip="在 Golang 中打印调用栈信息">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the comments</noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 SelFree. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
              
                
              
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://www.orztu.com/post/ffmpeg-commands/" data-tooltip="ffmpeg 命令行">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
              
                
              
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://www.orztu.com/post/golang-trace/" data-tooltip="在 Golang 中打印调用栈信息">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/f47b51d6d6b82fd9048e3eaf64bf7e69?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">SelFree</h4>
    
      <div id="about-card-bio"><strong>城市永远年轻，而我们终将老去</strong></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Programer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        ChengDu·China
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="//www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/fucking-egg-society/">
                <h3 class="media-heading">Fucking-Egg</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2021
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/wsl-command/">
                <h3 class="media-heading">Git is very slow in WSL</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2020
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Git 最近切换到 Windows 工作，使用 WSL 作为命令行方案。但在 WSL 里面安装 git 后，在工程里面执行命令时，总感觉非常缓慢。 执行一下 git status 都要卡好一会儿。
经过一番搜索，原因大概是 Windows 的路径索引到 WSL 之间有一个转换导致的？具体没有细看。
但找到一个解决方案：
 先在 Windows 中安装 Git，然后在 WSL 里面用 git.exe 替代 Linux 版本的 git。
 因为我使用的oh-my-zsh，所以通过在.zshrc中定义git函数针对 WSL 路径和 Windows 路径区别处理（这个代码是抄的）：
function git() { if $(pwd -P | grep -q &#34;^\/mnt\/.\/*&#34;); then git.exe &#34;$@&#34; else command git &#34;$@&#34; fi } 但这样做需要注意两个环境的.gitconfig不是共用的。 可以配置includeIf，通过匹配 gitdir， 在 WSL 里面引用 Windows 的 .gitconfig；又在 Windows 里面引用 WSL 的 .</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/ffmpeg-commands/">
                <h3 class="media-heading">ffmpeg 命令行</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>首先，并非专业视频处理人员；以下命令都是我从网上搜索后修改以为己所用。</p>
<h2 id="图片转视频">图片转视频</h2>
<pre><code># gif 转视频（DURATION：时长，gif会循环播放）
ffmpeg -ignore_loop 0 -t DURATION -f gif -i &quot;INPUT.gif&quot; -vcodec libx264 -crf 5 &quot;OUTPUT.mp4&quot;

# png、jpg 转视频
ffmpeg -loop 1 -framerate 30 -f image2 -t DURATION -i &quot;INPUT.jpg&quot; -vcodec libx264 -crf 5 &quot;OUTPUT.mp4&quot;
</code></pre></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/little-problem-while-using-cocos2dx-lua/">
                <h3 class="media-heading">记一次 Cocos2dx-Lua 闪退</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><h2 id="闪退点">闪退点</h2>
<p>Version: Cocos2dx-Lua 3.16</p>
<p>在某个页面修改后，出现闪退。查看修改记录没有特别的地方，均为修改图片或者条件判断。</p>
<p>启动 XCode 发现闪退位置出现在<code>void Node::onEnterTransitionDidFinish()</code>中，
在其调用子节点的<code>child-&gt;onEnterTransitionDidFinish()</code>时，<code>child</code>指针无效。</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/golang-trace/">
                <h3 class="media-heading">在 Golang 中打印调用栈信息</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>在日志信息中，有时需要获取当前函数的调用信息，比如打印调用栈：</p>
<h2 id="调用栈">调用栈</h2>
<h3 id="debugstack-byte">debug.Stack() []byte</h3>
<p><code>debug.Stack()</code>函数可以获取当前 goroutine 的调用栈信息，需要<code>import &quot;runtime/debug&quot;</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;--- BEGIN ---&#34;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">debug</span><span class="p">.</span><span class="nf">Stack</span><span class="p">()))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;--- END ---&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">boom</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">foo</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">boom</span><span class="p">()</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/lua-table-minify-ii/">
                <h3 class="media-heading">使用元表优化 Lua 配置文件 II</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>上回提到<a href="https://www.orztu.com/post/lua-table-minify/">元表优化 Lua 配置文件</a>，以减少重复字段，节省内存开销。</p>
<p>除了这种直接地减少内存开销的方法，使用元表还能实现数据的延迟加载，从另一个角度节约内存。</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/lua-table-minify/">
                <h3 class="media-heading">使用元表优化 Lua 配置文件</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><h2 id="配置文件">配置文件</h2>
<p>在游戏工程中，通常有大量配置是由策划提供，再转换成程序方便读取的格式添加到工程中。</p>
<p>在我参与的<code>Cocos2dx-Lua</code>工程中，策划通常在<code>Excel</code>中配置，再通过脚本转换为<code>Lua-Table</code>的文件。</p>
<p>比如常见的道具表转换后：</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/cgo-introduce/">
                <h3 class="media-heading">CGO —— Golang 与 C 语言混合编程</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>C 语言与 Golang 相互调用的简单例子。</p>
<p>在此使用一段简单的代码展示 CGO 的基本用法 —— 在 Go 程序中使用 C 语言编程。</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/using-govendor/">
                <h3 class="media-heading">govendor 使用</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><h2 id="govendor">govendor</h2>
<p>go vendor 是 go 1.6 官方正式引入的包管理方式。</p>
<p>其基本思路是，将引用的外部包的源代码放在当前工程的<code>vendor</code>目录下面，go 编译时会优先从<code>vendor</code>目录寻找依赖关系。</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.orztu.com/post/go-get-through-a-proxy/">
                <h3 class="media-heading">go get through a proxy</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>由于众所不知的原因，在国内访问<code>golang.org</code>需要爬梯子。</p>
<p>所以使用<code>go get</code>安装某些包的时候，也要用梯子。</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         18 posts found
      </p>
    </div>
  </div>
</div>

    
  
    
      
      <div id="cover" style="background-image:url('https://www.orztu.com/images/cover/city.jpg');"></div>
    
  


    
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>




-<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/helpers/jquery.fancybox-thumbs.js"></script>


<script src="https://www.orztu.com/js/script.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', tabReplace:'    ', useBR: false });
  $('pre.code-highlight > code, pre:not(.chroma) > code').each(function(i, block) {
    
    
    
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/www.orztu.com\/post\/little-problem-while-using-cocos2dx-lua\/';
          
            this.page.identifier = '\/post\/little-problem-while-using-cocos2dx-lua\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'orztu';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    <amp-auto-ads type="adsense"
    data-ad-client="ca-pub-7873997855793576">
</amp-auto-ads>

  </body>
</html>

